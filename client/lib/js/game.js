var game={date:new Date,phisics:{gravity:.3,friction:.8},players:new Array,objects:new Array,background:new Array,objectives:new Array,creatures:new Array,controllers:new Array,collectables:new Array,screenPlay:null,errorAllowedY:5,errorAllowedX:1,debug:!0,debugData:[],endScreen:!1,self:this,canvas:null,pauseInput:!1,cinematics:!1,centered:0,centerVelocity:5,statusGame:null,score:0,activeObjective:null,sceneActions:function(){},titleScreen:!1,isMobile:function(){return!!/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)},colCheck:function(e,t){var a=e.position.x+e.width/2-(t.position.x+t.width/2),n=e.position.y+e.height/2-(t.position.y+t.height/2),r=e.width/2+t.width/2,i=e.height/2+t.height/2,o=null;if(Math.abs(a)<r&&Math.abs(n)<i){var c=r-Math.abs(a),s=i-Math.abs(n);c>=s?n>0?(o="t",e.position.y+=s):(o="b",e.position.y-=s):a>0?(o="l",e.position.x+=c):(o="r",e.position.x-=c)}return o},colCheck_temp:function(e,t){var a=e.position.x+e.width/2-(t.position.x+t.width/2),n=e.position.y+e.height/2-(t.position.y+t.height/2),r=e.width/2+t.width/2,i=e.height/2+t.height/2,o=null;if(Math.abs(a)<r&&Math.abs(n)<i){var c=r-Math.abs(a),s=i-Math.abs(n);o=c>=s?n>0?"t":"b":a>0?"l":"r"}return o},drawBackground:function(){for(var e=0;e<this.background.length;e++)this.background[e].animate("")},drawCreatures:function(){for(var e=0;e<this.creatures.length;e++)this.creatures[e].animate("")},drawObjects:function(){for(var e=0;e<this.objects.length;e++)this.objects[e].animate("")},drawControllers:function(){for(var e=0;e<this.controllers.length;e++)this.controllers[e].animate("")},drawCollectables:function(){for(var e=0;e<this.collectables.length;e++)this.collectables[e].animate("")},drawObjectives:function(){for(var e=0;e<this.objectives.length;e++)this.objectives[e].animate()},drawCharacters:function(e){for(var t=0;t<this.players.length;t++)this.players[t].animate(e)},disableInput:function(){game.pauseInput=!0,document.body.removeEventListener("keydown",handlerKeyDown),document.body.removeEventListener("keyup",handlerKeyUp)},enableInput:function(){game.pauseInput=!1,document.body.addEventListener("keydown",handlerKeyDown),document.body.addEventListener("keyup",handlerKeyUp)},enableMouse:function(){document.body.addEventListener("mousemove",handlerMouseMove),document.body.addEventListener("mousedown",handlerMouseDown),document.body.addEventListener("mouseup",handlerMouseUp)},renderMainScreen:function(){game.titleScreen=!0,TitleScreen()},render:function(){return game.titleScreen=!1,"terminated"===game.statusGame?(cancelAnimationFrame(game.render),!1):(game.canvas.ctx.clearRect(0,0,game.canvas.container.width,game.canvas.container.height),!game.pauseInput&&game.players[0].position.x>9*game.canvas.container.width/10&&0==game.creatures.length&&(game.centered=Math.abs(game.canvas.container.width/2)),game.players[0].life<1?(game.statusGame="terminated",finishGame(!1),!1):(game.drawBackground(),game.drawObjects(),game.drawCollectables(),game.drawCharacters(),game.drawCreatures(),game.drawObjectives(),game.players[0].collidingObjectives(),game.canvas.drawText("Life: "+game.players[0].life,{color:"#000",x:1,y:30,font:"30px Arial"}),game.canvas.drawText("Score: "+game.score,{color:"#000",x:1,y:80,font:"30px Arial"}),null!==game.activeObjective&&game.getObjective(game.activeObjective).doObjectives(),game.players[0].collidingCreatures(),game.sceneActions(),game.drawControllers(),game.clearFinishedObjectives(),game.centerAll(),void requestAnimationFrame(game.render)))},addPlayer:function(e){this.players.push(e)},addObject:function(e){this.objects.push(e)},addCollectable:function(e){this.collectables.push(e)},addBackground:function(e){this.background.push(e)},addObjective:function(e){this.objectives.push(e)},addCreature:function(e){this.creatures.push(e)},addController:function(e){this.controllers.push(e)},setCanvas:function(e){this.canvas=e},removeCreature:function(e){for(var t=0;t<game.creatures.length;t++)if(game.creatures[t].id==e)return"function"==typeof game.creatures[t].objectives.onDie&&game.creatures[t].objectives.onDie(),game.creatures.splice(t,1),!0;return!1},removeCollectable:function(e){for(var t=0;t<game.collectables.length;t++)if(game.collectables[t].id==e)return game.collectables.splice(t,1),!0;return!1},getObjective:function(e){for(var t=0;t<game.objectives.length;t++)if(game.objectives[t].id==e)return game.objectives[t];return!1},getCreatureByName:function(e){for(var t=0;t<game.creatures.length;t++)if(game.creatures[t].name==e)return game.creatures[t];return!1},getCollectableByName:function(e){for(var t=0;t<game.collectables.length;t++)if(game.collectables[t].name==e)return game.collectables[t];return!1},doCinematics:function(){},centerAll:function(){game.centered>0&&(this.centered-=3)},clearFinishedObjectives:function(){for(var e=0;e<this.objectives.length;e++)this.objectives[e].finish&&(game.objectives[e].doObjectives(),game.objectives.splice(e,1))}};